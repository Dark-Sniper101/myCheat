let INPUT = ("#..##..#.#.#.###.#..##.####..##..##.##.#.###.......##..#..#.#.#.#..#...##....#.#.##.###....###.#.##.##..##.#...##.##...#...##......##.#...#.......##.#.#..####.##..#.#.#.....##.....#....#.#.#.##..##..##.##.....###...#.#..###.#######.#.....###....#......#.###.#...#.#####.#.#.###..#...##.##.#..#...######.###.#.##...####..####.###...####........##...##.##.####...##.#.#...##.#####.#....#.....##..#......###..###.#.#..###..#.####......#.....#.#.#.###..#.#..#..#...##..##..#.##....#....#.##..###..#....##.##..#.###..\n" +
    "\n" +
    ".##.##...###.####.#.##..#.#.#.#.##.#.###....#.###....#..##.#####.#.#..##..##.##.#.#.########...###..\n" +
    "#.##..#..#.###...#..####.##.####.#..#...#..##...####...#..#.#.##...#.#.#.#..#...#.####..#..#..#....#\n" +
    "##...##.#.....#...##.###.#..#.#...#....##.##.###....#..##.#...###.###..#..#.#.#######..#...###...###\n" +
    ".##.###....#..#.#...#.###..##.##.####.###.#....##.####.#.#..###..##....#.#####.#.#.#....##...#.##..#\n" +
    ".##.#.#..##..#..#...#.#..#..##.#.########..####.##...#..#..##..#..##..##.......##.##..#..##..#..#.#.\n" +
    "#.#.###...###.##.##.#.#...#####.#.#......#.###..#..#.##..#.#.##.###...###..##.#..##.###..###.####.##\n" +
    "#.####.######....#####.......##....#.#...#..#.#..#.#.#####.#...###.#..###.......#.###.#.##.#.#...#..\n" +
    "....##.##.###.####..#.###.###.....####.##....#..###.###..#####...##.##.#.#..#..#..#.#.########.#.#..\n" +
    "##..#..#..#..####..#..#.#..###.#.####..###.##.###.##.###.###.#.##.##.#...#..#.###.###......#.####..#\n" +
    ".####.#..######.#.#...#..###.#..#.##...#####.#####.#####.#.....###.#.##.......#....####..#..#.#.#...\n" +
    "......#....#.#..##.####.....#.##..###....###..##...###.#....#####.#..###..#.#....#..###..#.#...#####\n" +
    "#.#.#########.##.#..##.#.#.##.#.##...###.#.....####...#..#..#####...#..#..#...##.#####.#.#....#..#.#\n" +
    "#..####.#.#......###.#....#.#.#####.#..#..#.####..#.#...#.#.#.###..###.###..###..##.#.#.#.##....#.##\n" +
    "#..#.#...###....##.#.##....##..#.#.#....#.##..########.###....###.#.##.#.####.###..#.#...#####.#.##.\n" +
    ".####.###.#####..#.###..#.#..######.#.###.....#..####..#.#..###.##.##.####.......#..#.#.####..##.#..\n" +
    "##.##.#.......#.....####.#.##.###..###......#.##..#.#.#..##.###.#.###.###...#.##.####.######..##.###\n" +
    "##..#......#..#..#.#.###..##..##...#...###....#...#..#.###...#.##.###..###....##..##..###.###.#...##\n" +
    "..#...#.###....#....#.#######..#.#..#..#.####...#.###.#.#..#....#.#.##.#.###.#...####.#.#....#..#.#.\n" +
    "..##........#.....#.###..#.####.#..####.#..#.....#####.##..#.#.#..##......#.#..##...#...##.##...#.##\n" +
    "##.#..##....##...##.#####.##........#.#..#..#..###.####....#...####...#..###.#####.##....###.#.####.\n" +
    ".#..#.#.#####..#.#.##.#.#.####.#..#...#..#....#....#..###########...##..####..##...#.##..#.#.##.....\n" +
    "..#..#.#.#.#........#...##.#..#..##.#.##.####...###....###.......#....##....#.###.##...###..#.###.#.\n" +
    "..#..#.##.###.###.##...#.####.###.###.##.#.####.##.#.##.###..#.##.##..#.###...#.##.#.##.#####...#...\n" +
    "...##..###.#####..#.#.###...##.....#.##..##..##.##.##..#...#..#####.#.####.#....####...#.###.##..###\n" +
    "###.####..##.#..#####.....###.####..##.#....#.#.#...#.#...###..###.#...#....##..##.#.#...#.##.####..\n" +
    "..#.#######..#.##.#...####...###..###.###..#..#######.###.##.##..#..#.#.####.##.##...######..#..##.#\n" +
    "###..#.###...####.#..#.##.#....#...#.#.#..#.####..#..#.##.#####..#.#......###..#..#..##.#.....##.#.#\n" +
    ".#.#####.##.#.#..#..###.###.##.#.##..#.......#####.###..#.#.###.#####.....####.#....######.#.#.###.#\n" +
    "#####...#..#....##......#.#..##..##.##.......#.........#.#......#....#.#.##...#..###.##.######.###..\n" +
    "#...#..#.####.##....#.#....##.#.#...#..#.#.#.#..####.#......#####....##.##.####....##....#####...#.#\n" +
    ".#.###....#.##.#...##.#.#.....#.#..#.#..##.#...#.....#.##.....###...##.#.#....##...#..##.#..##.#.#..\n" +
    "..#####.....#...##.#.....#.###.#..#....##.#..###.####...#.#.....###.##.#.#..####...#.###.#.#....#.##\n" +
    "#..####.#...###...##.##.#.#..#..###.#..#.#.#.##..#...#.##.##..#.###.#..#.#######..#.######..#.###...\n" +
    "...#..#.#.###.##.##.###.###.#...###.#.#.#..##.##.##.###....#.##.#.#.#.#.#.####.#####...#.#.##.##..#.\n" +
    "..##.#.###.#####..##.#..####..#..##..#.#..#.#..###.#.##.##..#.#..###..#..###...##...###...#####.####\n" +
    "###.#...##.#.###.##...#.####....#####.###..###.#...#.####..#.#.#.#.#..#.###.###......###...#..#.####\n" +
    ".###.....##..###.#.#####.#..##.#.##.#.#.#.....#.####..###.###....#.##..#...##...###......#....##..#.\n" +
    "..###.#.#####..##..#.###...#.##...##.#...####...#..#####..#..#.##.#.#....##.##..#..##...#.#..##.#..#\n" +
    ".###...........#..###.#.#....#.##.#.##..##.#...#.##.#......#.#.###..##..#.####.###........#.##.#...#\n" +
    "##.....#.#####.##.##..#.#.######..##...######..#...####.###..#.##.#.###..##.#########.....#.#.....##\n" +
    "###....#..###..##..###.....#.#......##.#.##.#.#..##.###.#..#####...#.#######..........####...#....#.\n" +
    ".###....#.#.#.#..##.#.#.#.##...#..#.###..#.......#.####...###.#.#.#....#.##########....######.#####.\n" +
    "..##...######..###..#...#..#..#####..###...#..######.#####.###.##.#.#..##....#.#...###..#......##.#.\n" +
    "##..##.#...#.#.#..###..##.##.#.##..###.###.#.......###..##.#######.##.##.#.####..#.#.#####.#...#.#..\n" +
    "#.#..##..##.##...#...#.######.#.#.#.#.....##...#.##.##.#..###...#...##....#....#.#..#.#.##...#.###..\n" +
    "....#.#.....#.###...#.#...##....##..#.#.#....##.###....#....#..#...#.#.#####.###.##.####.####.#.#...\n" +
    ".##...####.##.#....#.##..#....#...#.##...#.#......###.##.####..#.#######....#.#####..##.#.....##.#.#\n" +
    "....#.#....#...####..##..#.#.##......###.#...##..##..###..#.####..############....#...#..#......####\n" +
    "....#######..##.#.#...#..#.#..####....##..#.##.#.#...###...##..####...#..#.##.#.#####..###.####...#.\n" +
    "......###.#..#..###.##.#.#.#.#.#.##...##.##...##.#.#....##.#..#........#..###.#####....#####.#.####.\n" +
    "##...#########...##....#.#....#..#.#......#.##.#.###..#.##...#..######.#....#.###.#..#########.##...\n" +
    "#..#..#.##..#####..#.###.#.##..##.##..#.......##.#...###..##.#.###..###..##..##..#.#.###.##....#####\n" +
    "#.#.##..#.####.#.#.#..#......#.###.###..##...#.#.#.#...#.#..###.##...###.#...##.##.#.##...##.####.##\n" +
    "#..##.###...##.#....#.#####.####.###.###.#..##..#....##..#..###.......####..##..#..###.#.#.#.#...#..\n" +
    "#..#####...#.###..####.###.#..#...#..#...#..#.#...##.#..#..###.#....#.#......#..###..###.#.##.####..\n" +
    "##.##.#.####.#..##..#.###...###...#.....##....##...#.#..#..##.##.#...#..#.###.##..##..##.#.#.####.#.\n" +
    ".#.#.######.##...###.####.#...###.##.##.#.#.#..##.##.###.#..#.###..####.######.##..###.#....##.#..##\n" +
    "##.##.###.#...#####.#.#.....#.#.#...#.##.###.##...#.###...###......###...##...##.##.#....#......##..\n" +
    "...##.#.#..#..#.#..###......#...###.#.####.##...##...##.##.##.##....#.##...#.##.##.##......###..#...\n" +
    "#.#.....#.#..###...#.##..#..#.###..#######....#.###.#...#.##.#......##...#.###.##.#...#..#...#.#.#..\n" +
    ".##.##........##.#.#...#####.##....#.#...###.#.##....##.##...##..#..#.#..####.#..##..#...##.##..##.#\n" +
    "#.##.#.##.#.####....###.#..#..#.###....######.#.....####.#.#####..###..##.#.##.......###...##.#.###.\n" +
    ".#..###..#..#.####...#..#..##.####.#..#.###.##.#.....###......####....##...###.#...####...#.#####.##\n" +
    "....#.#...#.##.....#...#...#.###...#...###...##.##.###.##.#.####..#.##.#....####..#####..#.#..#..#.#\n" +
    ".###..##.#....##.###..#...##.##..###.###.#.##.##.####.####.######..#.#.#.###.##...####.#...##.#.#.#.\n" +
    "##..##.#......#.#.#...#..#.##.#.#.##.#..#.#..#.###.#..#...#..#...#...#.#..#....#.##..#######......#.\n" +
    ".......##..#..#.###.#..###..###.#####.###.##...##.###.#..###.##....#.....#..#.#.###.###.#.####..#...\n" +
    "#.#....###.##..##..#.#...##.#.#####.....#.#####.#.####.#.#....####..#..#.##.##....###...##.#.#.###.#\n" +
    ".....#..##.#..##.#####.#.###.#.##.#..##.##...##..##..#.#...##.#.####.####..#..##.##.#.#..##..##.....\n" +
    ".####.#.#.##..#....##..##.#...#....##.#.##.#.#.#.#...######.#..#.###.#.#.##....#...#..#.#.####..#..#\n" +
    "..###.###..#.##.#...###..##.##...##..##.###...####.###..#..#..#..###..##.#...#...#..##.#.#..........\n" +
    ".....#.#..##.#.#..####..#..####.#....#..#..#.##.#..##..#...####.#####.##.#...##.####.#...#.#.##.##..\n" +
    "###....##....#.###....###.#.###..###..##..#..#...#####.##.#..#..####.#.#..###..#.#...###.##....##.##\n" +
    "###...###.##...##.#####.#..##.#....##.###.#######..##.####.#..#..###.###..#.#..#.##.#..##.#######.#.\n" +
    ".####..#.#.###.#######.#.#...#.##.#...###.#.#..##.#.#....#.####..##...###..######.###..#####.##.###.\n" +
    ".#...##.#.####...##.#...#.#...##.....#.#..#..##..#.#.####..#.##.##...##.#####.#...#..##.#.#.##.#.#.#\n" +
    ".....##..##.####..##.#######..#..###.##.##..####.##..#.##...##..#..#....#...##.##.#..#...##.......#.\n" +
    "#..#######..#####..###.##..###....######..#..#.#.....#....##..#.#..#.#..#.##.####.##.#.###.#####.###\n" +
    ".##...#.##..###.#...##.#.#.###...#.#....##.####...#.###.###.###.##.###.##.###.#.####.....##..#.....#\n" +
    "##.##.#..#.......#..##....##..#####........#.###..##.#..##..#####.##.....###.#...#######.#...#.###.#\n" +
    ".####..#.#####......#..###.##.##.##.###.#.#.......##.#####...#.#.####..#.#..###...#.....#.####.###.#\n" +
    "##..#.##.#....##.#######.#.#.#.####...#.#.#.#.#.......######.#..###..###.#..##..#.##.#......#.##..##\n" +
    ".#.#.#.#...##.....##.#.#.........#.#.#.##.#.#...#.#.#.#.##....#..###.....###..###........###..#.##..\n" +
    ".##.......#.#.####.....#....#.#....##.........#.......###.#..###..####...#...#.##.......###...#..###\n" +
    "###...#####.#.###.......#.##.#####.###..###..##..##.#..####..####..###..###.#..#.###.##.#.###...#.#.\n" +
    "##.#.#.##.##..#....#..##.#.#.#..#...#.##.###..##.###.#..##.......##...#.###.#.###.###....#...#.####.\n" +
    ".###..##.........##.#.....###.##..#.#...#.#....###.####.###..###...#.#.##..#.#..#..#...#...#.....###\n" +
    "##.##.#...#..#..#....#........###.##.####.#.#..####..#..##.#...#...###...##.###.##.##.#########..#..\n" +
    ".##.###.#.........####..####....##...###..##.##..#.#######.##.##...#..#....#.##..#..#..###.###.#.###\n" +
    "#....#...##....###.####.#####.#.....##.#.##.#..#.....#...#.###...##.###.#.###..#.......####.##...#..\n" +
    ".....#..#.##....##.#..##.#.#.#.##.#.#.####..#.##..##.#.#.#.#.#.#.######..#....##.##...#..#...##..#..\n" +
    "....#.#.##...#.##..#...#.##...#.#.###.#####.#.##..###...##.##.#.#..##.##.#...#..#.....##..######.###\n" +
    "#....###.#...##.####.#..##.####.#...#.#....#.##...###........#..#..####.#.#.#....##.#.#.#.##..#.#..#\n" +
    "##.......#...##.####.###...#...#..##.....#..##..#......#.#..#.##..........#.#..#..#..####..##....#..\n" +
    "#....####.....#...#.#.#####.#...##.###......#.##...##.##..#.#....##....#.....##..###.......#..##.#.#\n" +
    "....#..#...#..##.###.##.##..#.#.##..########..###.##.#..#.#.###.....#..###..###....#..##.#.....#.##.\n" +
    "#..#.#..#.###..#.####.....#...#...##...#....##..##...###.#.#########..##..##.#.#.#.##.#...#.#..#...#\n" +
    "..##.####.#..##...##.#.###.###..##.#.##..##....#.#.###.#.###.###..#.###..##.....##......####.##.....\n" +
    ".###.###..#....##.#####.##.#.#.####.#.##..#.###..#...#..#.###.####.#.#...##..###.##.#####...##..##.#\n" +
    "...####.##.###.#.###...####.....#.#.###..#.##.###..###.#.###..#.##....#.####.#..#.#..###...#..#####.");

// taken from: https://github.com/SheepTester/hello-world/blob/master/advent-of-code/2021/day-20.js
[alg, inp] = INPUT.trim().split(/(?:\r?\n){2}/)
inp = inp.split(/(?:\r?\n){1}/)
bounds = {
    r: [0, inp.length-1],
    c: [0, inp[0].length-1],
}
lit = {}
for (const [r,row] of inp.entries()) {
    Array.from(row, (px, c) => {
        if (px === '#') lit[`${r},${c}`] = true
    })
}

const get = (m,r, c) => {
    const { bounds, lit, def } = m
    if (r < bounds.r[0] || r > bounds.r[1]) return def
    if (c < bounds.c[0] || c > bounds.c[1]) return def
    return lit[`${r},${c}`]
}
enhance = (m) => {
    const { bounds, lit, def } = m
    const newLit = {}
    for (let r = bounds.r[0]-1; r <= bounds.r[1]+1; r++)
        for (let c = bounds.c[0]-1; c <= bounds.c[1]+1; c++) {
            let entry = 0
            for (let i = 0; i < 9; i++) {
                if (get(m,r + (Math.floor(i / 3) - 1), c + (i % 3 - 1))) {
                    entry |= 1 << (8 - i)
                }
            }
            if (alg[entry] === '#') newLit[`${r},${c}`] = true
        }
    return {
        bounds: {
            r: [bounds.r[0] - 1, bounds.r[1] + 1],
            c: [bounds.c[0] - 1, bounds.c[1] + 1],
        },
        lit: newLit,
        def: def ?alg[512] === '#' : alg[0] === '#'
    }
}

let STEPS = [];
t = { bounds, lit, def: false }
for (let i = 50; i--;) {
    t = enhance(t)
    STEPS.push({...t})
}

function setup() {
    frameRate(24);
    createCanvas(800, 800);

}

function depthColor(x) {
    const w = {
        0: 'rgb(21, 34, 56)',
        1: 'rgb(25, 40, 65)',
        2: 'rgb(28, 46, 74)',
        3: 'rgb(32, 51, 84)',
        4: 'rgb(35, 57, 93)',
        5: 'rgb(48,74,114)',
        6: 'rgb(71,101,147)',
        7: 'rgb(89,119,167)',
        8: 'rgb(107,137,186)',
        9: 'rgb(148,179,227)',
    }
    return w[x] || 'black';
}

let K = 0;
let V = 0;

function draw() {
    background("#10101a");

    let Z = 1
    let S = STEPS[K]

    // background
    if (K % 2 === 1)
        stroke(depthColor(9));
    else
        stroke(depthColor(1));
    let on = Object.keys(S.lit)
    for (i = 0; i < on.length; ++i) {
        r = parseInt(on[i].split(',')[0])
        c = parseInt(on[i].split(',')[1])
        rect(r * 4 + 200, c * 4 + 200, 4, 4);
    }

    if (V++ > 10) {
        K = Math.min(STEPS.length - 1, K + 1)
        V = 0
    }
}